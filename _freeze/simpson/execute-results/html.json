{
  "hash": "eec3e593d02fdfda598f73fb8b956b0f",
  "result": {
    "engine": "knitr",
    "markdown": "\n\n# 심슨의 역설 {#simpson-paradox}\n\n영국의 통계학자 에드워드 심슨이 정리한 역설(Simpson paradox)로, 전반적인 추세가 경향성이 존재하는 것으로 보이지만, 그룹으로 나눠서 개별적으로 보게 되면 경향성이 사라지거나 해석이 반대로 되는 경우를 이른다. [^erick-simpson]: [Prof. Eric A. Suess(February 23, 2016), \"Simpson’s Paradox - Correlations and Slopes\"](http://rstudio-pubs-static.s3.amazonaws.com/155188_cc8b400f7d134a3e9de6cbfb8320e1e0.html) [^hr-example-simpson]: [Paul van der Laken (27 September 2017), \"Simpson’s Paradox: Two HR examples with R code.\"](https://paulvanderlaken.com/2017/09/27/simpsons-paradox-two-hr-examples-with-r-code/)\n\n[^erick-simpson] [^hr-example-simpson]\n\n중요한 변수(lurking variable)가 빠져서 주로 이런 역설이 발생한다.\n[심슨의 역설](https://statkclee.github.io/r-algorithm/r-history-of-probability.html#simpson-paradox-1951)은 확률의 역사에서 중요한 주제 중의 하나로 자리를 잡고 있다.\n\n\n$\\frac{a_1}{A_1} > \\frac{b_1}{B_1}$ 이고 $\\frac{a_2}{A_2} > \\frac{b_2}{B_2}$\n이라고 반드시 $\\frac{a_1+a_2}{(A_1+A_2)} > \\frac{(b_1+b_2)}{(B_1+B_2)}$ 인 것은 아니다. \n즉, \"각 부분에 대한 평균이 크다고 해서 전체에 대한 평균까지 크지는 않다\"는 의미이다.[^namu-simpson]\n\n[^namu-simpson]: [나무위키, \"심슨의 역설\"](https://namu.wiki/w/%EC%8B%AC%EC%8A%A8%EC%9D%98%20%EC%97%AD%EC%84%A4)\n\n<div class = \"row\">\n  <div class = \"col-md-6\">\n\n<iframe width=\"300\" height=\"180\" src=\"https://www.youtube.com/embed/ebEkn-BiW5k\" frameborder=\"0\" allow=\"autoplay; encrypted-media\" allowfullscreen></iframe>\n\n  </div>\n  <div class = \"col-md-6\">\n\n<iframe width=\"300\" height=\"180\" src=\"https://www.youtube.com/embed/E_ME4P9fQbo\" frameborder=\"0\" allow=\"autoplay; encrypted-media\" allowfullscreen></iframe>\n\n  </div>\n</div>\n\n# 심슨의 역설 사례 {#simpson-paradox-case-study}\n\n심슨의 역설 사례를 책페이지수와 책가격의 관계를 살펴보자.\n데이터는 책 유형(하드커버, 페이퍼백)은 두가지가 있고,\n페이지수와 책가격이 달러로 구성된 데이터프레임이다.\n\n## 데이터 시각화 {#simpson-paradox-case-study-EDA}\n\n이를 시각적으로 표현하면 관계가 음의 상관관계를 갖는 것을 알 수 있다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(cowplot)\nlibrary(extrafont)\nloadfonts()\n\nsimp_df <- tribble(\n    ~book_type, ~num_pages, ~book_price,\n    \"hardcover\", 150, 27.43, \n    \"hardcover\", 225, 48.76, \n    \"hardcover\", 342, 50.25, \n    \"hardcover\", 185, 32.01, \n    \"paperback\", 475, 10.00, \n    \"paperback\", 834, 15.73, \n    \"paperback\", 1020, 20.00, \n    \"paperback\", 790, 17.89)\n\nsimp_df %>% \n    ggplot(aes(x=num_pages, y=book_price)) +\n      geom_point(size=3) +\n      geom_smooth(method = \"lm\", se=FALSE)\n```\n\n::: {.cell-output-display}\n![](simpson_files/figure-html/simpson-data-1.png){width=672}\n:::\n:::\n\n\n## 기술통계량 {#simpson-paradox-case-study-EDA-cor}\n\n`num_pages`, `book_price` 두변수를 추출하여 상관계수를 도출한다.\n그리고 나서, 책 유형에 따른 상관관계도 도출해 낸다.\n먼저 책 유형에 관계없이 `num_pages`, `book_price` 상관관계는 `-0.5949366`으로 나름 강한 음의 상관계수가 관측된다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimp_df %>% \n    summarise(book_cor = cor(num_pages, book_price)) %>% \n    pull()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.5949366\n```\n\n\n:::\n:::\n\n\n이번에는 책 유형에 따른 상관계수는 어떤지 계산해 보자.\n이 경우, 하드커버는 `0.848`, 페이퍼백은 `0.956`로 강한 양의 상관관계가 존재함이 확인된다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimp_df %>% \n    group_by(book_type) %>% \n    summarise(book_cor = cor(num_pages, book_price))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  book_type book_cor\n  <chr>        <dbl>\n1 hardcover    0.848\n2 paperback    0.956\n```\n\n\n:::\n:::\n\n\n## 상관관계 시각화 {#simpson-paradox-case-study-EDA-cor-viz}\n\n앞서 확인한 결과를 책 유형별로 나눠 상관계수를 시각화한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimp_df %>% \n    ggplot(aes(x=num_pages, y=book_price, color=book_type)) +\n      geom_point(size=3) +\n      geom_smooth(method = \"lm\", se=FALSE) +\n      theme_minimal(base_family = \"NanumGothic\") +\n      labs(x=\"책페이지 수\", y=\"책가격($)\", title=\"심슨의 역설 사례\", color=\"책유형\" )+\n      theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](simpson_files/figure-html/simpson-data-cor-viz-1.png){width=672}\n:::\n:::\n\n\n# 심슨의 역설 기사 {#simpson-paradox-news-article}\n\n심슨의 역설에 대해서 [동아사이언스](http://dl.dongascience.com/search?keyword=%EC%8B%AC%EC%8A%A8%EC%9D%98+%EC%97%AD%EC%84%A4)에서 2008년, 2013년 3회 심슨의 역설에 대한 기사를 실었는데 \"명문대 남녀 합격생의 반전\", \"오류를 잡아라! 확률 법정\" 의 기사가 눈에 띈다.\n\n- [박경미 교수의 수학캠핑 - 확률 패러독스, \"명문대 남녀 합격생의 반전\"](http://dl.dongascience.com/magazine/view/S201307N052)\n- [최영준(2013), \"오류를 잡아라! 확률 법정\", 수학동아](http://dl.dongascience.com/magazine/view/M201302N008)\n\n## UC 버클리 입학 [^simpson-berkeley] {#simpson-paradox-berkeley}\n\n[^simpson-berkeley]: [Johnny Hong(January 30, 2016), \"A (very) brief introduction to ggplot2\"](http://jcyhong.github.io/ggplot_demo.html)\n\n심슨의 역설관련 가장 유명한 사례는 1973년 UC 버클리 대학 입학데이터로 입학에 성차별이 존재하는지에 관한 데이터다.\n\n\n<div class = \"row\">\n  <div class = \"col-md-6\">\n**성별에 따른 입학률 비교**  \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(datasets)\nadmin_df <- UCBAdmissions %>% tbl_df\n\nadmin_df %>% \n    group_by(Gender, Admit) %>% \n    dplyr::summarise(total = sum(n)) %>% \n    spread(Admit, total) %>% \n    mutate(Admitted_Pcnt = Admitted/ (Admitted+Rejected),\n           Rejected_Pcnt = Rejected/ (Admitted+Rejected)) %>% \n    DT::datatable(options = list(scrollX = TRUE)) %>% \n    DT::formatPercentage(c(\"Admitted_Pcnt\",\"Rejected_Pcnt\"), digits=1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-b0056650ec3d947584a4\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b0056650ec3d947584a4\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\"],[\"Female\",\"Male\"],[557,1198],[1278,1493],[0.3035422343324251,0.4451876625789669],[0.6964577656675749,0.5548123374210331]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>Gender<\\/th>\\n      <th>Admitted<\\/th>\\n      <th>Rejected<\\/th>\\n      <th>Admitted_Pcnt<\\/th>\\n      <th>Rejected_Pcnt<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"columnDefs\":[{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[2,3,4,5]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"Gender\",\"targets\":1},{\"name\":\"Admitted\",\"targets\":2},{\"name\":\"Rejected\",\"targets\":3},{\"name\":\"Admitted_Pcnt\",\"targets\":4},{\"name\":\"Rejected_Pcnt\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n  </div>\n  <div class = \"col-md-6\">\n**복사하여 붙여넣기**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadmin_df %>% \n    group_by(Gender, Admit, Dept) %>% \n    dplyr::summarise(total = sum(n)) %>% \n    spread(Admit, total) %>% \n    mutate(Admitted_Pcnt = Admitted/ (Admitted+Rejected),\n           Rejected_Pcnt = Rejected/ (Admitted+Rejected)) %>% \n    DT::datatable(options = list(scrollX = TRUE)) %>% \n    DT::formatPercentage(c(\"Admitted_Pcnt\",\"Rejected_Pcnt\"), digits=1)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-42a7c463e83d785dd16e\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-42a7c463e83d785dd16e\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\"],[\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Female\",\"Male\",\"Male\",\"Male\",\"Male\",\"Male\",\"Male\"],[\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"A\",\"B\",\"C\",\"D\",\"E\",\"F\"],[89,17,202,131,94,24,512,353,120,138,53,22],[19,8,391,244,299,317,313,207,205,279,138,351],[0.8240740740740741,0.68,0.3406408094435076,0.3493333333333333,0.2391857506361323,0.07038123167155426,0.6206060606060606,0.6303571428571428,0.3692307692307693,0.3309352517985611,0.2774869109947644,0.05898123324396783],[0.1759259259259259,0.32,0.6593591905564924,0.6506666666666666,0.7608142493638677,0.9296187683284457,0.3793939393939394,0.3696428571428572,0.6307692307692307,0.6690647482014388,0.7225130890052356,0.9410187667560321]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>Gender<\\/th>\\n      <th>Dept<\\/th>\\n      <th>Admitted<\\/th>\\n      <th>Rejected<\\/th>\\n      <th>Admitted_Pcnt<\\/th>\\n      <th>Rejected_Pcnt<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"columnDefs\":[{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[3,4,5,6]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"Gender\",\"targets\":1},{\"name\":\"Dept\",\"targets\":2},{\"name\":\"Admitted\",\"targets\":3},{\"name\":\"Rejected\",\"targets\":4},{\"name\":\"Admitted_Pcnt\",\"targets\":5},{\"name\":\"Rejected_Pcnt\",\"targets\":6}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n  </div>\n</div>\n\n기술통계량을 통해 살펴본 사항을 그래프로 시각화한다. 막대 그래프를 통해 \n남성 합격률이 여성보다 높은 것으로 나타나 성차별이 존재하는 것으로 파악되지만,\n학과별로 놓고 보면 여성 합격률이 더 높거나 남성과 유사한 것으로 시각적으로 나타난다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A barplot for overall admission percentage for each gender.\n\nadmit_g <- admin_df %>% \n    group_by(Gender, Admit) %>% \n    dplyr::summarise(total = sum(n)) %>% \n    spread(Admit, total) %>% \n    mutate(Admitted_Pcnt = Admitted/ (Admitted+Rejected),\n           Rejected_Pcnt = Rejected/ (Admitted+Rejected)) %>% \n    ggplot(aes(x = Gender, y = Admitted_Pcnt, width = 0.2, fill=Gender)) +\n    geom_bar(stat = \"identity\") +\n    labs(x=\"성별\", y=\"입학합격율\", title=\"버클리 전체 입학합격률\") +\n    scale_y_continuous(labels = scales::percent, limits = c(0,1)) +\n    theme_minimal(base_family = \"NanumGothic\") +\n    theme(legend.position = \"none\") \n\nadmit_dept_g <- admin_df %>% \n    group_by(Gender, Admit, Dept) %>% \n    dplyr::summarise(total = sum(n)) %>% \n    spread(Admit, total) %>% \n    mutate(Admitted_Pcnt = Admitted/ (Admitted+Rejected),\n           Rejected_Pcnt = Rejected/ (Admitted+Rejected)) %>% \n    ggplot(aes(x = Gender, y = Admitted_Pcnt, fill=Gender)) +\n    geom_bar(stat = \"identity\") +\n    facet_grid(. ~ Dept) +\n    labs(x=\"성별\", y=\"\", title=\"버클리 학과별 입학합격률\") +\n    scale_y_continuous(labels = scales::percent, limits = c(0,1)) +\n    theme_bw(base_family = \"NanumGothic\") +\n    theme(axis.text.x = element_text(angle = 90, hjust = 1),\n          legend.position = \"none\") \n\nplot_grid(admit_g, admit_dept_g, labels = \"\")\n```\n\n::: {.cell-output-display}\n![](simpson_files/figure-html/berkeley-simpson-viz-1.png){width=1152}\n:::\n:::\n\n\n\n# 실제 사례 {#simpson-paradox-news-article-case}\n\n## 게임 업데이터 사례 [^game-case] {#simpson-paradox-news-article-game-case}\n\n[^game-case]: [NC소프트 (2017-07-05) \"데이터 분석을 이용한 게임 고객 모델링 #4\"](http://blog.ncsoft.com/?p=28900)\n\n예전에 모 게임에서 큰 규모의 업데이트를 한 후 게임 고객 동향을 분석한 적이 있습니다. 이 게임은 전체 게임 고객을 약 십 여가지 유형으로 분류하고 있는데, 크게 보면 게임 활동이 왕성하고 충성도가 높은 ‘진성’ 유형, 게임 활동이 그리 활발하지 않은 ‘라이트’ 유형, 자동 사냥 유저로 의심되는 ‘봇’ 유형 등이 있죠.\n\n이 게임의 업데이트 전/후 일별접속자수(DAU)와 유저당 결제금액(ARPU) 지표를 확인해 보니 아래와 같이 나왔습니다.\n\n<img src=\"images/ncsoft-simpson.png\" alt=\"게임 사례\" width=\"100%\" />\n\n일별 접속자수(DAU)가 크게 늘었지만 유저당 결재금액(ARPU)가 하락하여 뭔가 특단의 조치가 필요한 것으로 파악되지만, 이를 고객 집단을 반영하여 분석을 하게 되면 진성유저는 큰 차이가 없고, 크게 늘어난 유저가 봇이거나 Non-PU 유저라 봇을 비용으로 간주하여 제거하거나 Non-PU유저를 PU로 바꾸거나 PU 유저의 결재금액을 높이는 방향으로 사업적인 조치를 취하는 것이 바람직스러워 보인다.\n\n\n\n",
    "supporting": [
      "simpson_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.31/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}